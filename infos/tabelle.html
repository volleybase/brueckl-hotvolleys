<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <style>
*, html, body {
  font-family: Arial, Helvetica, sans-serif;
  font-size: 16px;
  text-align: left;
  border: 0;
  padding: 0;
  margin: 0;
  background: aliceblue;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
div#content {
  padding: 20px;
  white-space: pre;
  font-family: monospace;
}
  </style>

  <script src="/brueckl-hotvolleys/infos/script/request.js"></script>
  <script>
var map = {
  'u10': [18858, kidsResult, 'Tabelle U10'],
  'u11': [18865, kidsResult, 'Tabelle U11'],
  'u12': [18863, kidsResult, 'Tabelle U12'],
  'u13': [18861, kidsResult, 'Tabelle U13'],
  'u15w': [18859, kidsResult, 'Tabelle U15 weiblich'],
  'u15m': [18860, kidsResult, 'Tabelle U15 männlich'],
  'uld': [18839, leagueResult, 'Tabelle ULD'],
  'lld': [18830, leagueResult, 'Tabelle LLD'],
};

function _getTitle() {

  var key = '?';

  var parts = location.search.substring(1).split('&');
  if (parts.length == 1) {
    parts = parts[0].split('=');
    if (parts.length == 2) {
      key = parts[1];
    }
  }

  if (map && map[key] && map[key][2]) {
    return '<b>' + map[key][2] + '</b>\n';
  }

  return '';
}

function _fill(txt, len) {
  if (txt === undefined || txt === null || typeof txt !== 'string') {
    txt = '';
  }
  if (len < 0) {
    len *= -1;
    while (txt.length < len) {
      txt = ' ' + txt;
    }
  } else {
    while (txt.length < len) {
      txt += ' ';
    }
  }

  return txt.substr(0, len);
}

function _find(list, name) {
  if (list && list.length) {
    for (var i = 0; i < list.length; ++i) {
      if (list[i].nodeName === name) {
        return list[i].textContent;
      }
    }
  }
  return '';
}

/**
 * Creates the results for a junior chamionship.
 * @param {string} reponse The response from the web service.
 * @return {void}
 */
function kidsResult(response) {

  // create xml data
  var xml = _getXml(response);
  if (xml) {

    // get list of results
    var list = xml.getElementsByTagName('tabelle');
    if (list && list.length) {

      // create text
      var msg = _getTitle()
          + _fill('', 47) + 'P  T\n';
      for (var i = 0; i < list.length; ++i) {
        msg += _fill('' + (i + 1), -2) + '. '
            + _fill(_find(list[i].childNodes, 'tea_name'), 40)
            + _fill(_find(list[i].childNodes, 'punkte'), -4)
            + _fill(_find(list[i].childNodes, 'gespielt'), -3) + "\n";
      }

      // add created text to page
      _inject(msg);
    }
  }
}

/**
 * Creates the results for a league.
 * @param {string} reponse The response from the web service.
 * @return {void}
 */
function leagueResult(response) {

  // create xml data
  var xml = _getXml(response);
  if (xml) {

    // get list of results
    var list = xml.getElementsByTagName('tabelle');
    if (list && list.length) {

      // create text
      var msg = _getTitle()
          + _fill('', 51) + 'S/N  Sätze   Punkte\n'
          + _fill('', 45) + 'Sp.  +  -   +  -    +   -  P\n';
      for (var i = 0; i < list.length; ++i) {
        msg += _fill('' + (i + 1), -2) + '. '
            + _fill(_find(list[i].childNodes, 'tea_name'), 40)
            + _fill(_find(list[i].childNodes, 'gespielt'), -3)
            + _fill(_find(list[i].childNodes, 'gewonnen'), -4)
            + _fill(_find(list[i].childNodes, 'verloren'), -3)
            + _fill(_find(list[i].childNodes, 'satzgewonnen'), -4)
            + _fill(_find(list[i].childNodes, 'satzverloren'), -3)
            + _fill(_find(list[i].childNodes, 'punktgewonnen'), -5)
            + _fill(_find(list[i].childNodes, 'punktverloren'), -4)
            + _fill(_find(list[i].childNodes, 'punkte'), -3) + "\n";
      }

      // add created text to page
      _inject(msg);
    }
  }
}

/**
 * Creates a xml document from the response text.
 * @param {string} reponse The response from the web service.
 * @return {DOMDocument} The xml document.
 */
function _getXml(response) {

  try {
    // check
    if (window.DOMParser)
    {
      // create the parser, if ok, parse xml document from text and return it
      parser = new DOMParser();
      if (parser) {
        return parser.parseFromString(response, "text/xml");
      }
    }
  } catch (err) {}

  // simple error handling
  log("Cannot parse results!");
  return null;
}

/**
 * Add the results to the page.
 * @param {string} txt The text to add.
 * @return {void}
 */
function _inject(txt) {
  var div = document.getElementById('content');
  div.innerHTML = txt;
}

/**
 * Starts the loading of the results.
 * @return {void}
 */
function start() {
  var key = '?';

  var parts = location.search.substring(1).split('&');
  if (parts.length == 1) {
    parts = parts[0].split('=');
    if (parts.length == 2) {
      key = parts[1];
    }
  }

  if (map && map[key]) {
    getResults(map[key][0], map[key][1]);
  } else {
    _inject('Ungültige Tabelle!');
  }
}
  </script>
 </head>

 <body onload="start();">
  <div id="content">Loading...</div>
 </body>
</html>
